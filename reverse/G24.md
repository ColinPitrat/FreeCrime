# GTA 1 G24 file format

The G24 file format stores graphics and objects data for 24-bits version.

Most of the information in this page comes from
https://www.moddb.com/downloads/cityscape-data-structure

The format is very similar to the [GRY](GRY.md) file format. This page only
documents the differences.

TODO: dig into the G24 specificities.

## File format

| name | size | notes |
|------|------|-------|
| version code | UInt32 | currently 336 |
| side_size | UInt32 | no. bytes of side_block data |
| lid_size | UInt32 | no. bytes of lid_block data |
| aux_size | UInt32 | no. bytes of aux_block data |
| anim_size | UInt32 | no. bytes of anim data |
| clut_size | UInt32 | total bytes of clut data (before paging): 1024 \* the number of physical palettes |
| tileclut_size | UInt32 | no. bytes of tile cluts: 1024 \* the number of virtual palettes for tiles (lids) |
| spriteclut_size | UInt32 | no. bytes of sprite cluts: 1024 \* the number of virtual palettes for sprites |
| newcarclut_size | UInt32 | no. bytes of newcar cluts (car remaps + ped remaps): 1024 \* the number of virtual palettes for sprites |
| fontclut_size | UInt32 | no. bytes of font cluts: 1024 \* the number of virtual palettes for fonts |
| palette_index_size | UInt32 | no. bytes of palette index data |
| object_info_size | UInt32 | no. bytes of object_info data |
| car_size | UInt32 | no. bytes of car_info data |
| sprite_info_size | UInt32 | no. bytes of sprite_info data |
| sprite_graphics_size | UInt32 | no. bytes of sprite_graphics data |
| sprite_numbers_size | UInt32 | no. bytes of sprite_numbers data |
| side_block | side_size | |
| lid_block | lid_size | |
| aux_block | aux_size | |
| anim | anim_size | |
| clut | clut_size, rounded up to 64K | paged CLUT data : tiles, sprites, car remaps, ped remaps, fonts|
| palette_index |palette_index_size | |
| object_info | object_info_size | |
| car_info | car_size | |
| sprite_info | sprite_info_size | |
| sprite_graphics | sprite_graphics_size | |
| sprite_numbers | sprite_numbers_size | |

### Sprite Info

The sprite info header contains one more 16-bits integer compared to the GRY,
which provides the CLUT to use for this sprite. It's the index of the palette
among the sprite virtual palettes (so ranging from 0 to spriteclut_size/1024).

```
typedef struct {
	UInt16 size;		// bytes for this delta
	Char *ptr;
} delta_info_struct;

typedef struct {
	UInt8	w;		// width of the sprite in pixels (2-64, even)
	UInt8	h;		// height of the sprite in pixels (1-254)
	UInt8	delta_count;	// number of deltas stored for this sprite (0-32)
	UInt8	ws;		// scaling flag ( valid on consoles only )
	UInt16	size;	// bytes per frame, i.e. w x h
    UInt16  clut;   // index of the virtual palette in the sprites palettes
	Char   *ptr;
	delta_info_struct delta[MAX_DELTAS];
} sprite_info_struct;
```

### CLUT

The CLUT (color lookup table) sizes in the header do not seem to be reliable
outside of `clut_size` which is the total number of raw CLUT data. The actual
section in the file will be this size rounded-up to 64k (65536 bytes).

The other headers (`tileclut_size`, `spriteclut_size`, `newcarclut_size` and
`fontclut_size`) give the number of bytes in the CLUT of each type. They are
useful to compute the index of a CLUT in the palette_index.

The CLUT data consists in a list of palettes, each palette containing 256 colors
made of 4-bytes values, likely (R, G, B, A). These are the physical palettes.

There are 4 palettes per lid, side and aux block to leave space for the remaps
(although only lids can be remapped).

### remaps

The remap of objects seems to be completely ignored in 24-bits.
There are very few objects remapped in the game anyway (only a handful in the
first map, all using the same remap (1) for the same object: a tree). But these
trees don't display differently than the non-remapped one in the original games
(neither in 8 bits nor 24 bits mode).

### palette_index

Every graphic in the game uses an individual 256-colours palette (virtual
palettes). To save space, some of these palettes are shared and stored only
once (physical palette).

The `palette_index` section stores the mapping from virtual palette number to
physical palette number.

```
struct palette_index {
    Uint16 physical_palette[16384];
};
```
